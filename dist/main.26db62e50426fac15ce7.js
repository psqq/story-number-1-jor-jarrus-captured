!function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=15)}([function(t,e,i){"use strict";const r=2.3283064365386963e-10;class n{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(t){return t=t<1?1/t:t,this._seed=t,this._s0=(t>>>0)*r,t=69069*t+1>>>0,this._s1=t*r,t=69069*t+1>>>0,this._s2=t*r,this._c=1,this}getUniform(){let t=2091639*this._s0+this._c*r;return this._s0=this._s1,this._s1=this._s2,this._c=0|t,this._s2=t-this._c,this._s2}getUniformInt(t,e){let i=Math.max(t,e),r=Math.min(t,e);return Math.floor(this.getUniform()*(i-r+1))+r}getNormal(t=0,e=1){let i,r,n;do{n=(i=2*this.getUniform()-1)*i+(r=2*this.getUniform()-1)*r}while(n>1||0==n);return t+i*Math.sqrt(-2*Math.log(n)/n)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],i=t.slice();for(;i.length;){let t=i.indexOf(this.getItem(i));e.push(i.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let i in t)e+=t[i];let i,r=this.getUniform()*e,n=0;for(i in t)if(r<(n+=t[i]))return i;return i}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new n).setState(this.getState())}}e.a=(new n).setSeed(Date.now())},function(t,e,i){"use strict";i.d(e,"b",function(){return r}),i.d(e,"a",function(){return n}),i.d(e,"c",function(){return s}),i.d(e,"d",function(){return o});let r=80,n=25;const s={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]},o={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(1);class n{constructor(t=r.b,e=r.a){this._width=t,this._height=e}_fillMap(t){let e=[];for(let i=0;i<this._width;i++){e.push([]);for(let r=0;r<this._height;r++)e[i].push(t)}return e}}},function(t,e,i){"use strict";function r(t,e){return(t%e+e)%e}function n(t,e=0,i=1){return t<e?e:t>i?i:t}function s(t){return t.charAt(0).toUpperCase()+t.substring(1)}function o(t,...e){let i=o.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(r,n,o,h){if("%"==t.charAt(h-1))return r.substring(1);if(!e.length)return r;let l=e[0],a=(n||o).split(","),u=a.shift()||"",c=i[u.toLowerCase()];if(!c)return r;let _=(l=e.shift())[c].apply(l,a),f=u.charAt(0);return f!=f.toLowerCase()&&(_=s(_)),_})}i.r(e),i.d(e,"mod",function(){return r}),i.d(e,"clamp",function(){return n}),i.d(e,"capitalize",function(){return s}),i.d(e,"format",function(){return o}),o.map={s:"toString"}},function(t,e,i){"use strict";i.r(e),i.d(e,"fromString",function(){return s}),i.d(e,"add",function(){return o}),i.d(e,"add_",function(){return h}),i.d(e,"multiply",function(){return l}),i.d(e,"multiply_",function(){return a}),i.d(e,"interpolate",function(){return u}),i.d(e,"lerp",function(){return c}),i.d(e,"interpolateHSL",function(){return _}),i.d(e,"lerpHSL",function(){return f}),i.d(e,"randomize",function(){return p}),i.d(e,"rgb2hsl",function(){return d}),i.d(e,"hsl2rgb",function(){return m}),i.d(e,"toRGB",function(){return y}),i.d(e,"toHex",function(){return v});var r=i(3),n=i(0);function s(t){let e,i;if(t in b)e=b[t];else{if("#"==t.charAt(0)){let i=(t.match(/[0-9a-f]/gi)||[]).map(t=>parseInt(t,16));if(3==i.length)e=i.map(t=>17*t);else{for(let t=0;t<3;t++)i[t+1]+=16*i[t],i.splice(t,1);e=i}}else e=(i=t.match(/rgb\(([0-9, ]+)\)/i))?i[1].split(/\s*,\s*/).map(t=>parseInt(t)):[0,0,0];b[t]=e}return e.slice()}function o(t,...e){let i=t.slice();for(let t=0;t<3;t++)for(let r=0;r<e.length;r++)i[t]+=e[r][t];return i}function h(t,...e){for(let i=0;i<3;i++)for(let r=0;r<e.length;r++)t[i]+=e[r][i];return t}function l(t,...e){let i=t.slice();for(let t=0;t<3;t++){for(let r=0;r<e.length;r++)i[t]*=e[r][t]/255;i[t]=Math.round(i[t])}return i}function a(t,...e){for(let i=0;i<3;i++){for(let r=0;r<e.length;r++)t[i]*=e[r][i]/255;t[i]=Math.round(t[i])}return t}function u(t,e,i=.5){let r=t.slice();for(let n=0;n<3;n++)r[n]=Math.round(r[n]+i*(e[n]-t[n]));return r}const c=u;function _(t,e,i=.5){let r=d(t),n=d(e);for(let t=0;t<3;t++)r[t]+=i*(n[t]-r[t]);return m(r)}const f=_;function p(t,e){e instanceof Array||(e=Math.round(n.a.getNormal(0,e)));let i=t.slice();for(let t=0;t<3;t++)i[t]+=e instanceof Array?Math.round(n.a.getNormal(0,e[t])):e;return i}function d(t){let e,i=t[0]/255,r=t[1]/255,n=t[2]/255,s=Math.max(i,r,n),o=Math.min(i,r,n),h=0,l=(s+o)/2;if(s==o)e=0;else{let t=s-o;switch(e=l>.5?t/(2-s-o):t/(s+o),s){case i:h=(r-n)/t+(r<n?6:0);break;case r:h=(n-i)/t+2;break;case n:h=(i-r)/t+4}h/=6}return[h,e,l]}function g(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t}function m(t){let e=t[2];if(0==t[1])return[e=Math.round(255*e),e,e];{let i=t[1],r=e<.5?e*(1+i):e+i-e*i,n=2*e-r,s=g(n,r,t[0]+1/3),o=g(n,r,t[0]),h=g(n,r,t[0]-1/3);return[Math.round(255*s),Math.round(255*o),Math.round(255*h)]}}function y(t){return`rgb(${t.map(t=>Object(r.clamp)(t,0,255)).join(",")})`}function v(t){return`#${t.map(t=>Object(r.clamp)(t,0,255).toString(16).padStart(2,"0")).join("")}`}const b={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]}},function(t,e,i){"use strict";i.d(e,"b",function(){return s}),i.d(e,"a",function(){return o});var r=i(0);class n{}class s extends n{constructor(t,e,i,r,n,s){super(),this._x1=t,this._y1=e,this._x2=i,this._y2=r,this._doors={},void 0!==n&&void 0!==s&&this.addDoor(n,s)}static createRandomAt(t,e,i,n,s){let o=s.roomWidth[0],h=s.roomWidth[1],l=r.a.getUniformInt(o,h);o=s.roomHeight[0],h=s.roomHeight[1];let a=r.a.getUniformInt(o,h);if(1==i){let i=e-Math.floor(r.a.getUniform()*a);return new this(t+1,i,t+l,i+a-1,t,e)}if(-1==i){let i=e-Math.floor(r.a.getUniform()*a);return new this(t-l,i,t-1,i+a-1,t,e)}if(1==n){let i=t-Math.floor(r.a.getUniform()*l);return new this(i,e+1,i+l-1,e+a,t,e)}if(-1==n){let i=t-Math.floor(r.a.getUniform()*l);return new this(i,e-a,i+l-1,e-1,t,e)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(t,e,i){let n=i.roomWidth[0],s=i.roomWidth[1],o=r.a.getUniformInt(n,s);n=i.roomHeight[0],s=i.roomHeight[1];let h=r.a.getUniformInt(n,s),l=t-Math.floor(r.a.getUniform()*o),a=e-Math.floor(r.a.getUniform()*h);return new this(l,a,l+o-1,a+h-1)}static createRandom(t,e,i){let n=i.roomWidth[0],s=i.roomWidth[1],o=r.a.getUniformInt(n,s);n=i.roomHeight[0],s=i.roomHeight[1];let h=r.a.getUniformInt(n,s),l=t-o-1,a=e-h-1,u=1+Math.floor(r.a.getUniform()*l),c=1+Math.floor(r.a.getUniform()*a);return new this(u,c,u+o-1,c+h-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,i=this._x2+1,r=this._y1-1,n=this._y2+1;for(let s=e;s<=i;s++)for(let o=r;o<=n;o++)s!=e&&s!=i&&o!=r&&o!=n||t(s,o)||this.addDoor(s,o);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let i=this._x1-1,r=this._x2+1,n=this._y1-1,s=this._y2+1;for(let o=i;o<=r;o++)for(let h=n;h<=s;h++)if(o==i||o==r||h==n||h==s){if(!t(o,h))return!1}else if(!e(o,h))return!1;return!0}create(t){let e=this._x1-1,i=this._x2+1,r=this._y1-1,n=this._y2+1,s=0;for(let o=e;o<=i;o++)for(let h=r;h<=n;h++)t(o,h,s=o+","+h in this._doors?2:o==e||o==i||h==r||h==n?1:0)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}class o extends n{constructor(t,e,i,r){super(),this._startX=t,this._startY=e,this._endX=i,this._endY=r,this._endsWithAWall=!0}static createRandomAt(t,e,i,n,s){let o=s.corridorLength[0],h=s.corridorLength[1],l=r.a.getUniformInt(o,h);return new this(t,e,t+i*l,e+n*l)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let i=this._startX,r=this._startY,n=this._endX-i,s=this._endY-r,o=1+Math.max(Math.abs(n),Math.abs(s));n&&(n/=Math.abs(n)),s&&(s/=Math.abs(s));let h=s,l=-n,a=!0;for(let u=0;u<o;u++){let c=i+u*n,_=r+u*s;if(e(c,_)||(a=!1),t(c+h,_+l)||(a=!1),t(c-h,_-l)||(a=!1),!a){o=u,this._endX=c-n,this._endY=_-s;break}}if(0==o)return!1;if(1==o&&t(this._endX+n,this._endY+s))return!1;let u=!t(this._endX+n+h,this._endY+s+l),c=!t(this._endX+n-h,this._endY+s-l);return this._endsWithAWall=t(this._endX+n,this._endY+s),!u&&!c||!this._endsWithAWall}create(t){let e=this._startX,i=this._startY,r=this._endX-e,n=this._endY-i,s=1+Math.max(Math.abs(r),Math.abs(n));r&&(r/=Math.abs(r)),n&&(n/=Math.abs(n));for(let o=0;o<s;o++){t(e+o*r,i+o*n,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,i=this._startY,r=this._endX-e,n=this._endY-i;r&&(r/=Math.abs(r)),n&&(n/=Math.abs(n));let s=n,o=-r;t(this._endX+r,this._endY+n),t(this._endX+s,this._endY+o),t(this._endX-s,this._endY-o)}}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});class r{getContainer(){return null}setOptions(t){this._options=t}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(2);class n extends r.a{constructor(t,e){super(t,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}},function(t,e,i){var r;void 0===(r=function(t,e){"use strict";e.__esModule=!0;var i={x:30,y:30},r={eps:1e-5,map:{size:i,cellSize:1,fgColor:"grey",bgColor:"black"},rotjsDisplayOptions:{width:i.x,height:i.y,fontSize:16,forceSquareRatio:!0}};e.default=r}.apply(e,[i,e]))||(t.exports=r)},function(t,e,i){var r;void 0===(r=function(t,e){"use strict";e.__esModule=!0;e.default={systemEvents:{priorityChanged:"priority-changed"},engineEvents:{entityCreated:"entity-created",entityRemoved:"enitty-removed"}}}.apply(e,[i,e]))||(t.exports=r)},function(t,e,i){"use strict";i.r(e),i.d(e,"default",function(){return l});var r=i(7),n=i(5),s=i(0),o=i(1);const h={room:n.b,corridor:n.a};class l extends r.a{constructor(t,e,i={}){super(t,e),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},i),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let e=(this._width-2)*(this._height-2);this._firstRoom();let i,r=Date.now();do{if(i=0,Date.now()-r>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let e=t.split(","),n=parseInt(e[0]),s=parseInt(e[1]),o=this._getDiggingDirection(n,s);if(!o)continue;let h=0;do{if(h++,this._tryFeature(n,s,o[0],o[1])){this._removeSurroundingWalls(n,s),this._removeSurroundingWalls(n-o[0],s-o[1]);break}}while(h<this._featureAttempts);for(let t in this._walls)this._walls[t]>1&&i++}while(this._dug/e<this._options.dugPercentage||i);if(this._addDoors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this._walls={},this._map=[],this}_digCallback(t,e,i){0==i||2==i?(this._map[t][e]=0,this._dug++):this._walls[t+","+e]=1}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}_priorityWallCallback(t,e){this._walls[t+","+e]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),i=n.b.createRandomCenter(t,e,this._options);this._rooms.push(i),i.create(this._digCallback)}_findWall(){let t=[],e=[];for(let i in this._walls){2==this._walls[i]?e.push(i):t.push(i)}let i=e.length?e:t;if(!i.length)return null;let r=s.a.getItem(i.sort());return delete this._walls[r],r}_tryFeature(t,e,i,r){let o=s.a.getWeightedValue(this._features),l=h[o].createRandomAt(t,e,i,r,this._options);return!!l.isValid(this._isWallCallback,this._canBeDugCallback)&&(l.create(this._digCallback),l instanceof n.b&&this._rooms.push(l),l instanceof n.a&&(l.createPriorityWalls(this._priorityWallCallback),this._corridors.push(l)),!0)}_removeSurroundingWalls(t,e){let i=o.c[4];for(let r=0;r<i.length;r++){let n=i[r],s=t+n[0],o=e+n[1];delete this._walls[s+","+o],s=t+2*n[0],o=e+2*n[1],delete this._walls[s+","+o]}}_getDiggingDirection(t,e){if(t<=0||e<=0||t>=this._width-1||e>=this._height-1)return null;let i=null,r=o.c[4];for(let n=0;n<r.length;n++){let s=r[n],o=t+s[0],h=e+s[1];if(!this._map[o][h]){if(i)return null;i=s}}return i?[-i[0],-i[1]]:null}_addDoors(){let t=this._map;function e(e,i){return 1==t[e][i]}for(let t=0;t<this._rooms.length;t++){let i=this._rooms[t];i.clearDoors(),i.addDoors(e)}}}},function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return o});var r=i(6),n=i(4);function s(t){let e=n.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class o extends r.a{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],i=this.computeSize();this._offset=i.map((t,i)=>Math.floor((t-e[i])/2))}clear(){t.stdout.write(`[0;48;5;${s(this._options.bg)}m[2J`)}draw(e,i){let[r,n,o,h,l]=e,a=this._offset[0]+r,u=this._offset[1]+n,c=this.computeSize();if(a<0||a>=c[0])return;if(u<0||u>=c[1])return;if(a===this._cursor[0]&&u===this._cursor[1]||(t.stdout.write(function(t,e){return`[${e+1};${t+1}H`}(a,u)),this._cursor[0]=a,this._cursor[1]=u),i&&(o||(o=" ")),!o)return;let _=function(t,e){return`[0;38;5;${s(t)};48;5;${s(e)}m`}(h,l);_!==this._lastColor&&(t.stdout.write(_),this._lastColor=_);let f=[].concat(o);t.stdout.write(f[0]),this._cursor[0]++,this._cursor[0]>=c[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}}).call(this,i(17))},function(t,e,i){var r,n,s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=this&&this.__generator||function(t,e){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function h(s){return function(h){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,h])}}},l=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},u=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t},c=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};r=[i,e,i(13),i(18),i(19),i(9)],void 0===(n=function(t,e,i,r,n,s){"use strict";e.__esModule=!0,i=c(i),r=c(r),n=c(n),s=c(s);var _=function(t){function e(){var e=t.call(this)||this;return e.systems=[],e.systemGroups=new Map,e.entities=new Map,e.components=new Map,e.killedEntities=new Set,e}return o(e,t),e.prototype.addComponentToEntity=function(t,e){var i=e.constructor;this.components.has(i.name)||this.components.set(i.name,new Set),this.components.get(i.name).add(t),this.entities.has(t)||this.entities.set(t,new Map),this.entities.get(t).set(i.name,e)},e.prototype.createEntity=function(){for(var t,e,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var h=r.default();try{for(var a=l(i),u=a.next();!u.done;u=a.next()){var c=u.value;this.addComponentToEntity(h,c)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return this.emit(s.default.engineEvents.entityCreated,new n.default(h,i)),h},e.prototype.hasComponent=function(t,e){return this.entities.get(t).has(e.name)},e.prototype.hasComponents=function(t,e){var i,r;try{for(var n=l(e),s=n.next();!s.done;s=n.next()){var o=s.value;if(!this.hasComponent(t,o))return!1}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}return!0},e.prototype._getComponents=function(){var t,e,i,r,n,s,o,a,u,c,_,f,p,d=[];for(t=0;t<arguments.length;t++)d[t]=arguments[t];return h(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),e=l(this.entities.keys()),i=e.next(),t.label=1;case 1:if(i.done)return[3,4];if(r=i.value,!this.hasComponents(r,d))return[3,3];n=[];try{for(f=void 0,s=l(d),o=s.next();!o.done;o=s.next())a=o.value,n.push(this.entities.get(r).get(a.name))}catch(t){f={error:t}}finally{try{o&&!o.done&&(p=s.return)&&p.call(s)}finally{if(f)throw f.error}}return[4,[r,n]];case 2:t.sent(),t.label=3;case 3:return i=e.next(),[3,1];case 4:return[3,7];case 5:return u=t.sent(),c={error:u},[3,7];case 6:try{i&&!i.done&&(_=e.return)&&_.call(e)}finally{if(c)throw c.error}return[7];case 7:return[2]}})},e.prototype.iterEntitiesOfTheseComponents=function(){var t,e,i,r,s,o,c,_,f,p=[];for(t=0;t<arguments.length;t++)p[t]=arguments[t];return h(this,function(t){switch(t.label){case 0:t.trys.push([0,5,6,7]),e=l(this._getComponents.apply(this,u(p))),i=e.next(),t.label=1;case 1:return i.done?[3,4]:(r=a(i.value,2),s=r[0],o=r[1],[4,new n.default(s,o)]);case 2:t.sent(),t.label=3;case 3:return i=e.next(),[3,1];case 4:return[3,7];case 5:return c=t.sent(),_={error:c},[3,7];case 6:try{i&&!i.done&&(f=e.return)&&f.call(e)}finally{if(_)throw _.error}return[7];case 7:return[2]}})},e.prototype.getEntitiesOfTheseComponents=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return u(this.iterEntitiesOfTheseComponents.apply(this,u(t)))},e.prototype._addSystemToGroup=function(t,e){void 0===e&&(e=""),this.systemGroups.has(e)||this.systemGroups.set(e,[]),this.systemGroups.get(e).push(t),this.sortSystemsByPriority(this.systemGroups.get(e))},e.prototype.addSystem=function(t,e,i){var r=this;void 0===e&&(e=0),void 0===i&&(i=null),t.setPriority(e),this.systems.push(t),this.sortSystemsByPriority(this.systems),null!==i&&this._addSystemToGroup(t,i),t.on(s.default.systemEvents.priorityChanged,function(){r._sortAll()})},e.prototype._sortAll=function(){var t,e;this.sortSystemsByPriority(this.systems);try{for(var i=l(this.systemGroups.values()),r=i.next();!r.done;r=i.next()){var n=r.value;this.sortSystemsByPriority(n)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e.prototype._updateSystems=function(t,e){var i,r;try{for(var n=l(t),s=n.next();!s.done;s=n.next()){s.value.update(e)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}},e.prototype.updateSystemsOfTheseGroups=function(t,e){var i,r,n=new Set;try{for(var s=l(t),o=s.next();!o.done;o=s.next()){var h=o.value;this.systemGroups.get(h).map(function(t){return n.add(t)})}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}var a=u(n);this.sortSystemsByPriority(a),this._updateSystems(a,e)},e.prototype.sortSystemsByPriority=function(t){t.sort(function(t,e){return e.getPriority()-t.getPriority()})},e.prototype.update=function(t){void 0===t&&(t=0),this._updateSystems(this.systems,t)},e}(i.default);e.default=_}.apply(e,r))||(t.exports=n)},function(t,e,i){var r;
/*!
 * EventEmitter v5.2.5 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */!function(e){"use strict";function n(){}var s=n.prototype,o=e.EventEmitter;function h(t,e){for(var i=t.length;i--;)if(t[i].listener===e)return i;return-1}function l(t){return function(){return this[t].apply(this,arguments)}}s.getListeners=function(t){var e,i,r=this._getEvents();if(t instanceof RegExp)for(i in e={},r)r.hasOwnProperty(i)&&t.test(i)&&(e[i]=r[i]);else e=r[t]||(r[t]=[]);return e},s.flattenListeners=function(t){var e,i=[];for(e=0;e<t.length;e+=1)i.push(t[e].listener);return i},s.getListenersAsObject=function(t){var e,i=this.getListeners(t);return i instanceof Array&&((e={})[t]=i),e||i},s.addListener=function(t,e){if(!function t(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&t(e.listener)}(e))throw new TypeError("listener must be a function");var i,r=this.getListenersAsObject(t),n="object"==typeof e;for(i in r)r.hasOwnProperty(i)&&-1===h(r[i],e)&&r[i].push(n?e:{listener:e,once:!1});return this},s.on=l("addListener"),s.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},s.once=l("addOnceListener"),s.defineEvent=function(t){return this.getListeners(t),this},s.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},s.removeListener=function(t,e){var i,r,n=this.getListenersAsObject(t);for(r in n)n.hasOwnProperty(r)&&-1!==(i=h(n[r],e))&&n[r].splice(i,1);return this},s.off=l("removeListener"),s.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},s.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},s.manipulateListeners=function(t,e,i){var r,n,s=t?this.removeListener:this.addListener,o=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(r=i.length;r--;)s.call(this,e,i[r]);else for(r in e)e.hasOwnProperty(r)&&(n=e[r])&&("function"==typeof n?s.call(this,r,n):o.call(this,r,n));return this},s.removeEvent=function(t){var e,i=typeof t,r=this._getEvents();if("string"===i)delete r[t];else if(t instanceof RegExp)for(e in r)r.hasOwnProperty(e)&&t.test(e)&&delete r[e];else delete this._events;return this},s.removeAllListeners=l("removeEvent"),s.emitEvent=function(t,e){var i,r,n,s,o=this.getListenersAsObject(t);for(s in o)if(o.hasOwnProperty(s))for(i=o[s].slice(0),n=0;n<i.length;n++)!0===(r=i[n]).once&&this.removeListener(t,r.listener),r.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(t,r.listener);return this},s.trigger=l("emitEvent"),s.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},s.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},s._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},s._getEvents=function(){return this._events||(this._events={})},n.noConflict=function(){return e.EventEmitter=o,n},void 0===(r=function(){return n}.call(e,i,e,t))||(t.exports=r)}("undefined"!=typeof window?window:this||{})},function(t,e,i){var r,n,s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};r=[i,e,i(21)],void 0===(n=function(t,e,i){"use strict";e.__esModule=!0;var r=function(t){function e(e){var i=t.call(this)||this;return i.map=e||new Map,i}return o(e,t),e}((i=h(i)).default);e.default=r}.apply(e,r))||(t.exports=n)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function h(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,h)}l((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function h(s){return function(h){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,h])}}},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__,exports,__webpack_require__(16)],__WEBPACK_AMD_DEFINE_RESULT__=function(require,exports,app_1){"use strict";function main(){return __awaiter(this,void 0,void 0,function(){var app;return __generator(this,function(_a){switch(_a.label){case 0:return app=new app_1.default,eval("window.app = app"),[4,app.load()];case 1:return _a.sent(),app.init(),app.run(),[2]}})})}exports.__esModule=!0,app_1=__importDefault(app_1),main()}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(t,e,i){var r,n,s=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{l(r.next(t))}catch(t){s(t)}}function h(t){try{l(r.throw(t))}catch(t){s(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,h)}l((r=r.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function h(s){return function(h){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,h])}}},h=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e},l=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};r=[i,e,i(27),i(8),i(12),i(20),i(22),i(23)],void 0===(n=function(t,e,i,r,n,a,u,c){"use strict";e.__esModule=!0,i=h(i),r=l(r),n=l(n),a=l(a),u=l(u),c=l(c);var _=function(){function t(){this.display=null,this.appElement=null,this.engine=new n.default}return t.prototype.load=function(){return s(this,void 0,void 0,function(){return o(this,function(t){return[2]})})},t.prototype.initAppElement=function(){var t=document.querySelector("body");t.style.margin="0",t.innerHTML="",this.appElement=document.createElement("div"),t.appendChild(this.appElement)},t.prototype.init=function(){this.initAppElement(),this.display=new i.Display(r.default.rotjsDisplayOptions),this.appElement.appendChild(this.display.getContainer()),this.initEngine()},t.prototype.initEngine=function(){this.engine=new n.default,this.engine=new u.default(this.engine).addSystem(new c.default(this.engine,this.display)).withGroup("display").getEngine(),(new a.default).createDungeon().addCreatedEntitiesToEngine(this.engine)},t.prototype.run=function(){this.engine.update()},t}();e.default=_}.apply(e,r))||(t.exports=n)},function(t,e){var i,r,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function h(t){if(i===setTimeout)return setTimeout(t,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(t){i=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(t){r=o}}();var l,a=[],u=!1,c=-1;function _(){u&&l&&(u=!1,l.length?a=l.concat(a):c=-1,a.length&&f())}function f(){if(!u){var t=h(_);u=!0;for(var e=a.length;e;){for(l=a,a=[];++c<e;)l&&l[c].run();c=-1,e=a.length}l=null,u=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function d(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];a.push(new p(t,e)),1!==a.length||u||h(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,i){var r;void 0===(r=function(t,e){"use strict";e.__esModule=!0;var i=0;e.default=function(){return i++}}.apply(e,[i,e]))||(t.exports=r)},function(t,e,i){var r,n=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};void 0===(r=function(t,e){"use strict";e.__esModule=!0;var i=function(){function t(t,e){this.components=e,this.id=t}return t.prototype.getId=function(){return this.id},t.prototype.get=function(t){var e,i;try{for(var r=n(this.components),s=r.next();!s.done;s=r.next()){var o=s.value;if(o instanceof t)return o}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},t}();e.default=i}.apply(e,[i,e]))||(t.exports=r)},function(t,e,i){var r,n,s=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},h=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t},l=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};r=[i,e,i(10),i(8),i(14)],void 0===(n=function(t,e,i,r,n){"use strict";e.__esModule=!0,i=l(i),r=l(r),n=l(n);var o=function(){function t(){this.entities=[]}return t.prototype.addCreatedEntitiesToEngine=function(t){var e,i;try{for(var r=s(this.entities),n=r.next();!n.done;n=r.next()){var o=n.value;t.createEntity.apply(t,h(o))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return this.entities=[],this},t.prototype.createDungeon=function(){for(var t=new Map,e=0;e<r.default.map.size.x;e++)for(var s=0;s<r.default.map.size.y;s++)t.set(e+","+s,"#");return new i.default(r.default.map.size.x,r.default.map.size.y).create(function(e,i,r){r?t.set(e+","+i,"#"):t.set(e+","+i,".")}),this.entities.push([new n.default(t)]),this},t}();e.default=o}.apply(e,r))||(t.exports=n)},function(t,e,i){var r;void 0===(r=function(t,e){"use strict";e.__esModule=!0;var i=function(){return function(){}}();e.default=i}.apply(e,[i,e]))||(t.exports=r)},function(t,e,i){var r,n,s=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};r=[i,e,i(12)],void 0===(n=function(t,e,i){"use strict";e.__esModule=!0,i=o(i);var r=function(){function t(t){this.priorityForNextSystem=0,this.prority=0,this.engine=t||new i.default,this.system=null,this.groups=null,this.prority=null}return t.prototype._clearCurrentSystemSettings=function(){this.system=null,this.groups=null,this.prority=null},t.prototype._addCurrentSystemIfNeed=function(){var t,e;if(this.system){this.prority||(this.prority=this.priorityForNextSystem),this.priorityForNextSystem-=1,this.system.setPriority(this.prority),this.engine.addSystem(this.system);try{for(var i=s(this.groups),r=i.next();!r.done;r=i.next()){var n=r.value;this.engine._addSystemToGroup(this.system,n)}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}}},t.prototype.addSystem=function(t){return this._addCurrentSystemIfNeed(),this.system=t,this.groups=new Set,this},t.prototype.withPriority=function(t){return this.system.setPriority(t),this},t.prototype.withOnlyTheseGroups=function(t){return this.groups=new Set(t),this},t.prototype.withOnlyThisGroup=function(t){return this.groups=new Set([t]),this},t.prototype.withGroup=function(t){return this.groups.add(t),this},t.prototype.getEngine=function(){this._addCurrentSystemIfNeed();var t=this.engine;return this.engine=null,t},t}();e.default=r}.apply(e,r))||(t.exports=n)},function(t,e,i){var r,n,s,o=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),h=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};r=[i,e,i(24),i(26),i(14),i(8)],void 0===(n=function(t,e,i,r,n,s){"use strict";e.__esModule=!0,i=l(i),r=l(r),n=l(n),s=l(s);var a=function(t){function e(e,i){var s=t.call(this,e)||this;return s.entities=new r.default(e,[n.default]),s.display=i,s}return o(e,t),e.prototype.update=function(t){var e,i;void 0===t&&(t=0);try{for(var r=h(this.entities.getEnties()),o=r.next();!o.done;o=r.next())for(var l=o.value.get(n.default).map,a=0;a<s.default.map.size.x;a++)for(var u=0;u<s.default.map.size.y;u++){var c=s.default.map.fgColor,_=s.default.map.bgColor,f=l.get(a+","+u);this.display.draw(a,u,f,c,_)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},e}(i.default);e.default=a}.apply(e,r))||(t.exports=n)},function(t,e,i){(function(r){var n,s,o,h=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),l=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};n=[i,e,i(13),i(9)],void 0===(s=function(t,e,i,r){"use strict";e.__esModule=!0,i=l(i),r=l(r);var n=function(t){function e(e,i){void 0===i&&(i=0);var r=t.call(this)||this;return r.priority=0,r.engine=e,r.priority=i,r}return h(e,t),e.prototype.setPriority=function(t){var e=this.priority;return this.priority=t,e!==t&&this.emit(r.default.systemEvents.priorityChanged),this},e.prototype.getPriority=function(){return this.priority},e.prototype.clear=function(){this.engine=null,this.priority=0},e.prototype.update=function(t){void 0===t&&(t=0)},e.prototype.getDeltaTimeForNextState=function(){return{amountOfTime:0,isChanges:!1}},e}(i.default);e.default=n}.apply(e,n))||(t.exports=s)}).call(this,i(25))},function(t,e){t.exports={import:function(){throw new Error("System.import cannot be used indirectly")}}},function(t,e,i){var r,n,s=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};r=[i,e,i(9)],void 0===(n=function(t,e,i){"use strict";e.__esModule=!0,i=s(i);var r=function(){function t(t,e){var r=this;this.engine=t,this.components=e,this.entities=[],this.engine.on(i.default.engineEvents.entityCreated,function(t){r.engine.hasComponents(t.getId(),r.components)&&r.entities.push(t)}),this.engine.on(i.default.engineEvents.entityRemoved,function(t){r.entities=r.entities.filter(function(e){return e.getId()!=t.getId()})})}return t.prototype.getEnties=function(){return this.entities},t}();e.default=r}.apply(e,r))||(t.exports=n)},function(t,e,i){"use strict";i.r(e);var r={};i.r(r),i.d(r,"TYPE_TEXT",function(){return b}),i.d(r,"TYPE_NEWLINE",function(){return w}),i.d(r,"TYPE_FG",function(){return x}),i.d(r,"TYPE_BG",function(){return E}),i.d(r,"measure",function(){return S}),i.d(r,"tokenize",function(){return C});var n=i(0),s=i(6);class o extends s.a{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,r=i.getBoundingClientRect();return t-=r.left,e-=r.top,t*=i.width/r.width,e*=i.height/r.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}var h=i(3);class l extends o{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,e){let[i,r,n,s,o]=t,h=[(i+1)*this._spacingX,r*this._spacingY+this._hexSize];if(this._options.transpose&&h.reverse(),e&&(this._ctx.fillStyle=o,this._fill(h[0],h[1])),!n)return;this._ctx.fillStyle=s;let l=[].concat(n);for(let t=0;t<l.length;t++)this._ctx.fillText(l[t],h[0],Math.ceil(h[1]))}computeSize(t,e){return this._options.transpose&&(t+=e,t-=e=t-e),[Math.floor(t/this._spacingX)-1,Math.floor((e-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,e){this._options.transpose&&(t+=e,t-=e=t-e);let i=2*t/((this._options.width+1)*Math.sqrt(3))-1,r=e/(2+1.5*(this._options.height-1)),n=Math.min(i,r),s=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let o=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=s;let h=o/100,l=2*(n=Math.floor(n)+1)/(this._options.spacing*(1+h/Math.sqrt(3)));return Math.ceil(l)-1}_normalizedEventToPosition(t,e){let i;this._options.transpose?(t+=e,t-=e=t-e,i=this._ctx.canvas.width):i=this._ctx.canvas.height;let r=i/this._options.height;return e=Math.floor(e/r),Object(h.mod)(e,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,e]}_fill(t,e){let i=this._hexSize,r=this._options.border;const n=this._ctx;n.beginPath(),this._options.transpose?(n.moveTo(t-i+r,e),n.lineTo(t-i/2+r,e+this._spacingX-r),n.lineTo(t+i/2-r,e+this._spacingX-r),n.lineTo(t+i-r,e),n.lineTo(t+i/2-r,e-this._spacingX+r),n.lineTo(t-i/2+r,e-this._spacingX+r),n.lineTo(t-i+r,e)):(n.moveTo(t,e-i+r),n.lineTo(t+this._spacingX-r,e-i/2+r),n.lineTo(t+this._spacingX-r,e+i/2-r),n.lineTo(t,e+i-r),n.lineTo(t-this._spacingX+r,e+i/2-r),n.lineTo(t-this._spacingX+r,e-i/2+r),n.lineTo(t,e-i+r)),n.fill()}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);let i,r;this._hexSize=Math.floor(t.spacing*(t.fontSize+e/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(i="height",r="width"):(i="width",r="height"),this._ctx.canvas[i]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[r]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}class a extends o{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,e){a.cache?this._drawWithCache(t):this._drawNoCache(t,e)}_drawWithCache(t){let e,[i,r,n,s,o]=t,h=""+n+s+o;if(h in this._canvasCache)e=this._canvasCache[h];else{let t=this._options.border,i=(e=document.createElement("canvas")).getContext("2d");if(e.width=this._spacingX,e.height=this._spacingY,i.fillStyle=o,i.fillRect(t,t,e.width-t,e.height-t),n){i.fillStyle=s,i.font=this._ctx.font,i.textAlign="center",i.textBaseline="middle";let t=[].concat(n);for(let e=0;e<t.length;e++)i.fillText(t[e],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[h]=e}this._ctx.drawImage(e,i*this._spacingX,r*this._spacingY)}_drawNoCache(t,e){let[i,r,n,s,o]=t;if(e){let t=this._options.border;this._ctx.fillStyle=o,this._ctx.fillRect(i*this._spacingX+t,r*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!n)return;this._ctx.fillStyle=s;let h=[].concat(n);for(let t=0;t<h.length;t++)this._ctx.fillText(h[t],(i+.5)*this._spacingX,Math.ceil((r+.5)*this._spacingY))}computeSize(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}computeFontSize(t,e){let i=Math.floor(t/this._options.width),r=Math.floor(e/this._options.height),n=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let s=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=n;let o=s/100*r/i;return o>1&&(r=Math.floor(r/o)),Math.floor(r/this._options.spacing)}_normalizedEventToPosition(t,e){return[Math.floor(t/this._spacingX),Math.floor(e/this._spacingY)]}_updateSize(){const t=this._options,e=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*e),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}a.cache=!1;class u extends o{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,r,n,s,o]=t,h=this._options.tileWidth,l=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*h,r*l,h,l):(this._ctx.fillStyle=o,this._ctx.fillRect(i*h,r*l,h,l))),!n)return;let a=[].concat(n),u=[].concat(s),c=[].concat(o);for(let t=0;t<a.length;t++){let e=this._options.tileMap[a[t]];if(!e)throw new Error(`Char "${a[t]}" not found in tileMap`);if(this._options.tileColorize){let n=this._colorCanvas,s=n.getContext("2d");s.globalCompositeOperation="source-over",s.clearRect(0,0,h,l);let o=u[t],a=c[t];s.drawImage(this._options.tileSet,e[0],e[1],h,l,0,0,h,l),"transparent"!=o&&(s.fillStyle=o,s.globalCompositeOperation="source-atop",s.fillRect(0,0,h,l)),"transparent"!=a&&(s.fillStyle=a,s.globalCompositeOperation="destination-over",s.fillRect(0,0,h,l)),this._ctx.drawImage(n,i*h,r*l,h,l)}else this._ctx.drawImage(this._options.tileSet,e[0],e[1],h,l,i*h,r*l,h,l)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}var c=i(4);class _ extends s.a{static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(t){alert(t.message)}}schedule(t){requestAnimationFrame(t)}getContainer(){return this._gl.canvas}setOptions(t){super.setOptions(t),this._updateSize();let e=this._options.tileSet;e&&"complete"in e&&!e.complete?e.addEventListener("load",()=>this._updateTexture(e)):this._updateTexture(e)}draw(t,e){const i=this._gl,r=this._options;let[n,s,o,h,l]=t,a=i.canvas.height-(s+1)*r.tileHeight;if(i.scissor(n*r.tileWidth,a,r.tileWidth,r.tileHeight),e&&(r.tileColorize?i.clearColor(0,0,0,0):i.clearColor(...m(l)),i.clear(i.COLOR_BUFFER_BIT)),!o)return;let u=[].concat(o),c=[].concat(l),_=[].concat(h);i.uniform2fv(this._uniforms.targetPosRel,[n,s]);for(let t=0;t<u.length;t++){let e=this._options.tileMap[u[t]];if(!e)throw new Error(`Char "${u[t]}" not found in tileMap`);i.uniform1f(this._uniforms.colorize,r.tileColorize?1:0),i.uniform2fv(this._uniforms.tilesetPosAbs,e),r.tileColorize&&(i.uniform4fv(this._uniforms.tint,m(_[t])),i.uniform4fv(this._uniforms.bg,m(c[t]))),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}clear(){const t=this._gl;t.clearColor(...m(this._options.bg)),t.scissor(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT)}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(t,e){let i=this._gl.canvas,r=i.getBoundingClientRect();return t-=r.left,e-=r.top,t*=i.width/r.width,e*=i.height/r.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}_initWebGL(){let t=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=t;let e=function(t,e,i){const r=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r)||"");const n=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(n,i),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n)||"");const s=t.createProgram();if(t.attachShader(s,r),t.attachShader(s,n),t.linkProgram(s),!t.getProgramParameter(s,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(s)||"");return s}(t,p,d);return t.useProgram(e),function(t){const e=new Float32Array([0,0,1,0,0,1,1,1]),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.enableVertexAttribArray(0),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}(t),f.forEach(i=>this._uniforms[i]=t.getUniformLocation(e,i)),this._program=e,t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.SCISSOR_TEST),t}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._gl,e=this._options,i=[e.width*e.tileWidth,e.height*e.tileHeight];t.canvas.width=i[0],t.canvas.height=i[1],t.viewport(0,0,i[0],i[1]),t.uniform2fv(this._uniforms.tileSize,[e.tileWidth,e.tileHeight]),t.uniform2fv(this._uniforms.targetSize,i)}_updateTexture(t){!function(t,e){let i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}(this._gl,t)}}const f=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],p="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),d="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();let g={};function m(t){if(!(t in g)){let e;if("transparent"==t)e=[0,0,0,0];else if(t.indexOf("rgba")>-1){e=(t.match(/[\d.]+/g)||[]).map(Number);for(let t=0;t<3;t++)e[t]=e[t]/255}else(e=c.fromString(t).map(t=>t/255)).push(1);g[t]=e}return g[t]}var y=i(11);const v=/%([bc]){([^}]*)}/g,b=0,w=1,x=2,E=3;function S(t,e){let i={width:0,height:1},r=C(t,e),n=0;for(let t=0;t<r.length;t++){let e=r[t];switch(e.type){case b:n+=e.value.length;break;case w:i.height++,i.width=Math.max(i.width,n),n=0}}return i.width=Math.max(i.width,n),i}function C(t,e){let i=[],r=0;t.replace(v,function(e,n,s,o){let h=t.substring(r,o);return h.length&&i.push({type:b,value:h}),i.push({type:"c"==n?x:E,value:s.trim()}),r=o+e.length,""});let n=t.substring(r);return n.length&&i.push({type:b,value:n}),function(t,e){e||(e=1/0);let i=0,r=0,n=-1;for(;i<t.length;){let s=t[i];if(s.type==w&&(r=0,n=-1),s.type!=b){i++;continue}for(;0==r&&" "==s.value.charAt(0);)s.value=s.value.substring(1);let o=s.value.indexOf("\n");if(-1!=o){s.value=T(t,i,o,!0);let e=s.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();s.value=e.join("")}if(s.value.length){if(r+s.value.length>e){let o=-1;for(;;){let t=s.value.indexOf(" ",o+1);if(-1==t)break;if(r+t>e)break;o=t}if(-1!=o)s.value=T(t,i,o,!0);else if(-1!=n){let e=t[n],r=e.value.lastIndexOf(" ");e.value=T(t,n,r,!0),i=n}else s.value=T(t,i,e-r,!1)}else r+=s.value.length,-1!=s.value.indexOf(" ")&&(n=i);i++}else t.splice(i,1)}t.push({type:w});let s=null;for(let e=0;e<t.length;e++){let i=t[e];switch(i.type){case b:s=i;break;case w:if(s){let t=s.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();s.value=t.join("")}s=null}}return t.pop(),t}(i,e)}function T(t,e,i,r){let n={type:w},s={type:b,value:t[e].value.substring(i+(r?1:0))};return t.splice(e+1,0,n,s),t[e].value.substring(0,i)}var M=i(1);const V={hex:l,rect:a,tile:u,"tile-gl":_,term:y.a},k={width:M.b,height:M.a,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};class K{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},k,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let r=[this._options.bg,this._options.fg];this.draw(t,e,null,null,r[i%r.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=V[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,r,n){r||(r=this._options.fg),n||(n=this._options.bg);let s=`${t},${e}`;this._data[s]=[t,e,i,r,n],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[s]=!0)}drawText(t,e,i,r){let n=null,s=null,o=t,h=e,l=1;r||(r=this._options.width-t);let a=C(i,r);for(;a.length;){let e=a.shift();switch(e.type){case b:let i=!1,r=!1,a=!1,u=!1;for(let t=0;t<e.value.length;t++){let l=e.value.charCodeAt(t),c=e.value.charAt(t);a=l>65280&&l<65377||l>65500&&l<65512||l>65518,i=32==c.charCodeAt(0)||12288==c.charCodeAt(0),!u||a||i||o++,a&&!r&&o++,this.draw(o++,h,c,n,s),r=i,u=a}break;case x:n=e.value||null;break;case E:s=e.value||null;break;case w:o=t,h++,l++}}return l}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}K.Rect=a,K.Hex=l,K.Tile=u,K.TileGL=_,K.Term=y.a;class O{constructor(t){this._options={words:!1,order:3,prior:.001},Object.assign(this._options,t),this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(let t=0;t<this._options.order;t++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}clear(){this._data={},this._priorValues={}}generate(){let t=[this._sample(this._prefix)];for(;t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))}observe(t){let e=this._split(t);for(let t=0;t<e.length;t++)this._priorValues[e[t]]=this._options.prior;e=this._prefix.concat(e).concat(this._suffix);for(let t=this._options.order;t<e.length;t++){let i=e.slice(t-this._options.order,t),r=e[t];for(let t=0;t<i.length;t++){let e=i.slice(t);this._observeEvent(e,r)}}}getStats(){let t=[],e=Object.keys(this._priorValues).length;e--,t.push("distinct samples: "+e);let i=Object.keys(this._data).length,r=0;for(let t in this._data)r+=Object.keys(this._data[t]).length;return t.push("dictionary size (contexts): "+i),t.push("dictionary size (events): "+r),t.join(", ")}_split(t){return t.split(this._options.words?/\s+/:"")}_join(t){return t.join(this._options.words?" ":"")}_observeEvent(t,e){let i=this._join(t);i in this._data||(this._data[i]={});let r=this._data[i];e in r||(r[e]=0),r[e]++}_sample(t){t=this._backoff(t);let e=this._join(t),i=this._data[e],r={};if(this._options.prior){for(let t in this._priorValues)r[t]=this._priorValues[t];for(let t in i)r[t]+=i[t]}else r=i;return n.a.getWeightedValue(r)}_backoff(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&t.length>0;)t=t.slice(1);return t}}class A{constructor(){this._time=0,this._events=[],this._eventTimes=[]}getTime(){return this._time}clear(){return this._events=[],this._eventTimes=[],this}add(t,e){let i=this._events.length;for(let t=0;t<this._eventTimes.length;t++)if(this._eventTimes[t]>e){i=t;break}this._events.splice(i,0,t),this._eventTimes.splice(i,0,e)}get(){if(!this._events.length)return null;let t=this._eventTimes.splice(0,1)[0];if(t>0){this._time+=t;for(let e=0;e<this._eventTimes.length;e++)this._eventTimes[e]-=t}return this._events.splice(0,1)[0]}getEventTime(t){let e=this._events.indexOf(t);if(-1!=e)return this._eventTimes[e]}remove(t){let e=this._events.indexOf(t);return-1!=e&&(this._remove(e),!0)}_remove(t){this._events.splice(t,1),this._eventTimes.splice(t,1)}}class P{constructor(){this._queue=new A,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(t,e){return e&&this._repeat.push(t),this}getTimeOf(t){return this._queue.getEventTime(t)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(t){let e=this._queue.remove(t),i=this._repeat.indexOf(t);return-1!=i&&this._repeat.splice(i,1),this._current==t&&(this._current=null),e}next(){return this._current=this._queue.get(),this._current}}var R={Simple:class extends P{add(t,e){return this._queue.add(t,0),super.add(t,e)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}},Speed:class extends P{add(t,e,i){return this._queue.add(t,void 0!==i?i:1/t.getSpeed()),super.add(t,e)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}},Action:class extends P{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,e,i){return this._queue.add(t,i||this._defaultDuration),super.add(t,e)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}};class L{constructor(t,e={}){this._lightPasses=t,this._options=Object.assign({topology:8},e)}_getCircle(t,e,i){let r,n,s,o=[];switch(this._options.topology){case 4:n=1,s=[0,1],r=[M.c[8][7],M.c[8][1],M.c[8][3],M.c[8][5]];break;case 6:r=M.c[6],n=1,s=[-1,1];break;case 8:r=M.c[4],n=2,s=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let h=t+s[0]*i,l=e+s[1]*i;for(let t=0;t<r.length;t++)for(let e=0;e<i*n;e++)o.push([h,l]),h+=r[t][0],l+=r[t][1];return o}}const D=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];var U={DiscreteShadowcasting:class extends L{compute(t,e,i,r){if(r(t,e,0,1),!this._lightPasses(t,e))return;let n,s,o,h,l,a=[];for(let u=1;u<=i;u++){let i=this._getCircle(t,e,u),c=360/i.length;for(let t=0;t<i.length;t++)if(o=i[t][0],h=i[t][1],s=(n=c*(t-.5))+c,l=!this._lightPasses(o,h),this._visibleCoords(Math.floor(n),Math.ceil(s),l,a)&&r(o,h,u,1),2==a.length&&0==a[0]&&360==a[1])return}}_visibleCoords(t,e,i,r){if(t<0){let n=this._visibleCoords(0,e,i,r),s=this._visibleCoords(360+t,360,i,r);return n||s}let n=0;for(;n<r.length&&r[n]<t;)n++;if(n==r.length)return i&&r.push(t,e),!0;let s=0;if(n%2){for(;n<r.length&&r[n]<e;)n++,s++;return 0!=s&&(i&&(s%2?r.splice(n-s,s,e):r.splice(n-s,s)),!0)}for(;n<r.length&&r[n]<e;)n++,s++;return(t!=r[n-s]||1!=s)&&(i&&(s%2?r.splice(n-s,s,t):r.splice(n-s,s,t,e)),!0)}},PreciseShadowcasting:class extends L{compute(t,e,i,r){if(r(t,e,0,1),!this._lightPasses(t,e))return;let n,s,o,h,l,a,u=[];for(let c=1;c<=i;c++){let i=this._getCircle(t,e,c),_=i.length;for(let t=0;t<_;t++)if(n=i[t][0],s=i[t][1],h=[t?2*t-1:2*_-1,2*_],l=[2*t+1,2*_],o=!this._lightPasses(n,s),(a=this._checkVisibility(h,l,o,u))&&r(n,s,c,a),2==u.length&&0==u[0][0]&&u[1][0]==u[1][1])return}}_checkVisibility(t,e,i,r){if(t[0]>e[0])return(this._checkVisibility(t,[t[1],t[1]],i,r)+this._checkVisibility([0,1],e,i,r))/2;let n=0,s=!1;for(;n<r.length;){let e=r[n],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0!=i||n%2||(s=!0);break}n++}let o=r.length,h=!1;for(;o--;){let t=r[o],i=e[0]*t[1]-t[0]*e[1];if(i>=0){0==i&&o%2&&(h=!0);break}}let l,a=!0;if(n==o&&(s||h)?a=!1:s&&h&&n+1==o&&o%2?a=!1:n>o&&n%2&&(a=!1),!a)return 0;let u=o-n+1;if(u%2)if(n%2){let t=r[n];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&r.splice(n,u,e)}else{let e=r[o];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&r.splice(n,u,t)}else{if(!(n%2))return i&&r.splice(n,u,t,e),1;{let t=r[n],e=r[o];l=(e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]),i&&r.splice(n,u)}}return l/((e[0]*t[1]-t[0]*e[1])/(t[1]*e[1]))}},RecursiveShadowcasting:class extends L{compute(t,e,i,r){r(t,e,0,1);for(let n=0;n<D.length;n++)this._renderOctant(t,e,D[n],i,r)}compute180(t,e,i,r,n){n(t,e,0,1);let s=(r-1+8)%8,o=(r-2+8)%8,h=(r+1+8)%8;this._renderOctant(t,e,D[o],i,n),this._renderOctant(t,e,D[s],i,n),this._renderOctant(t,e,D[r],i,n),this._renderOctant(t,e,D[h],i,n)}compute90(t,e,i,r,n){n(t,e,0,1);let s=(r-1+8)%8;this._renderOctant(t,e,D[r],i,n),this._renderOctant(t,e,D[s],i,n)}_renderOctant(t,e,i,r,n){this._castVisibility(t,e,1,1,0,r+1,i[0],i[1],i[2],i[3],n)}_castVisibility(t,e,i,r,n,s,o,h,l,a,u){if(!(r<n))for(let c=i;c<=s;c++){let i=-c-1,_=-c,f=!1,p=0;for(;i<=0;){let d=t+(i+=1)*o+_*h,g=e+i*l+_*a,m=(i-.5)/(_+.5),y=(i+.5)/(_-.5);if(!(y>r)){if(m<n)break;if(i*i+_*_<s*s&&u(d,g,c,1),f){if(!this._lightPasses(d,g)){p=y;continue}f=!1,r=p}else!this._lightPasses(d,g)&&c<s&&(f=!0,this._castVisibility(t,e,c+1,r,m,s,o,h,l,a,u),p=y)}}if(f)break}}}},I=i(2);var N=i(7),W=i(5);function z(t,e,i){i[e[t+1]]=i[t],e[i[t]]=e[t+1],i[t]=t+1,e[t+1]=t}function F(t,e,i){i[e[t]]=i[t],e[i[t]]=e[t],i[t]=t,e[t]=t}var X={Arena:class extends I.a{create(t){let e=this._width-1,i=this._height-1;for(let r=0;r<=e;r++)for(let n=0;n<=i;n++)t(r,n,r&&n&&r<e&&n<i?0:1);return this}},Uniform:class extends N.a{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this._map[e][i]);return this}_generateRooms(){let t,e=this._width-2,i=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let e=W.b.createRandom(this._width,this._height,this._options);if(e.isValid(this._isWallCallback,this._canBeDugCallback))return e.create(this._digCallback),this._rooms.push(e),e}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=n.a.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=n.a.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let i=this._closestRoom(this._connected,e);if(!i)break;if(!this._connectRooms(e,i))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,r=e.getCenter(),n=null;for(let e=0;e<t.length;e++){let s=t[e],o=s.getCenter(),h=o[0]-r[0],l=o[1]-r[1],a=h*h+l*l;a<i&&(i=a,n=s)}return n}_connectRooms(t,e){let i,r,n,s,o,h,l,a=t.getCenter(),u=e.getCenter(),c=u[0]-a[0],_=u[1]-a[1];if(Math.abs(c)<Math.abs(_)?(s=(2+(n=_>0?2:0))%4,o=e.getLeft(),h=e.getRight(),l=0):(s=(2+(n=c>0?1:3))%4,o=e.getTop(),h=e.getBottom(),l=1),!(i=this._placeInWall(t,n)))return!1;if(i[l]>=o&&i[l]<=h){r=i.slice();let t=0;switch(s){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}r[(l+1)%2]=t,this._digLine([i,r])}else if(i[l]<o-1||i[l]>h+1){let t=i[l]-u[l],n=0;switch(s){case 0:case 1:n=t<0?3:1;break;case 2:case 3:n=t<0?1:3}if(s=(s+n)%4,!(r=this._placeInWall(e,s)))return!1;let o=[0,0];o[l]=i[l];let h=(l+1)%2;o[h]=r[h],this._digLine([i,o,r])}else{let t=(l+1)%2;if(!(r=this._placeInWall(e,s)))return!1;let n=Math.round((r[t]+i[t])/2),o=[0,0],h=[0,0];o[l]=i[l],o[t]=n,h[l]=r[l],h[t]=n,this._digLine([i,o,h,r])}return t.addDoor(i[0],i[1]),e.addDoor(r[0],r[1]),-1!=(l=this._unconnected.indexOf(t))&&(this._unconnected.splice(l,1),this._connected.push(t)),-1!=(l=this._unconnected.indexOf(e))&&(this._unconnected.splice(l,1),this._connected.push(e)),!0}_placeInWall(t,e){let i=[0,0],r=[0,0],s=0;switch(e){case 0:r=[1,0],i=[t.getLeft(),t.getTop()-1],s=t.getRight()-t.getLeft()+1;break;case 1:r=[0,1],i=[t.getRight()+1,t.getTop()],s=t.getBottom()-t.getTop()+1;break;case 2:r=[1,0],i=[t.getLeft(),t.getBottom()+1],s=t.getRight()-t.getLeft()+1;break;case 3:r=[0,1],i=[t.getLeft()-1,t.getTop()],s=t.getBottom()-t.getTop()+1}let o=[],h=-2;for(let t=0;t<s;t++){let e=i[0]+t*r[0],n=i[1]+t*r[1];o.push(null),1==this._map[e][n]?h!=t-1&&(o[t]=[e,n]):(h=t,t&&(o[t-1]=null))}for(let t=o.length-1;t>=0;t--)o[t]||o.splice(t,1);return o.length?n.a.getItem(o):null}_digLine(t){for(let e=1;e<t.length;e++){let i=t[e-1],r=t[e],n=new W.a(i[0],i[1],r[0],r[1]);n.create(this._digCallback),this._corridors.push(n)}}_digCallback(t,e,i){this._map[t][e]=i,0==i&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}},Cellular:class extends I.a{constructor(t,e,i={}){super(t,e),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(i),this._dirs=M.c[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._map[e][i]=n.a.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,r=this._options.survive;for(let t=0;t<this._height;t++){let n=1,s=0;6==this._options.topology&&(n=2,s=t%2);for(let o=s;o<this._width;o+=n){let n=this._map[o][t],s=this._getNeighbors(o,t);n&&-1!=r.indexOf(s)?e[o][t]=1:n||-1==i.indexOf(s)||(e[o][t]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,r=0;6==this._options.topology&&(i=2,r=e%2);for(let n=r;n<this._width;n+=i)t(n,e,this._map[n][e])}}_getNeighbors(t,e){let i=0;for(let r=0;r<this._dirs.length;r++){let n=this._dirs[r],s=t+n[0],o=e+n[1];s<0||s>=this._width||o<0||o>=this._height||(i+=1==this._map[s][o]?1:0)}return i}connect(t,e,i){e||(e=0);let r=[],s={},o=1,h=[0,0];6==this._options.topology&&(o=2,h=[0,1]);for(let t=0;t<this._height;t++)for(let i=h[t%2];i<this._width;i+=o)if(this._freeSpace(i,t,e)){let e=[i,t];s[this._pointKey(e)]=e,r.push([i,t])}let l=r[n.a.getUniformInt(0,r.length-1)],a=this._pointKey(l),u={};for(u[a]=l,delete s[a],this._findConnected(u,s,[l],!1,e);Object.keys(s).length>0;){let t=this._getFromTo(u,s),r=t[0],n=t[1],o={};o[this._pointKey(r)]=r,this._findConnected(o,s,[r],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,n,r,u,s,e,i);for(let t in o){let i=o[t];this._map[i[0]][i[1]]=e,u[t]=i,delete s[t]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let i,r=[0,0],s=[0,0],o=Object.keys(t),h=Object.keys(e);for(let l=0;l<5;l++){if(o.length<h.length){let i=o;s=t[i[n.a.getUniformInt(0,i.length-1)]],r=this._getClosest(s,e)}else{let i=h;r=e[i[n.a.getUniformInt(0,i.length-1)]],s=this._getClosest(r,t)}if((i=(r[0]-s[0])*(r[0]-s[0])+(r[1]-s[1])*(r[1]-s[1]))<64)break}return[r,s]}_getClosest(t,e){let i=null,r=null;for(let n in e){let s=e[n],o=(s[0]-t[0])*(s[0]-t[0])+(s[1]-t[1])*(s[1]-t[1]);(null==r||o<r)&&(r=o,i=s)}return i}_findConnected(t,e,i,r,n){for(;i.length>0;){let s,o=i.splice(0,1)[0];s=6==this._options.topology?[[o[0]+2,o[1]],[o[0]+1,o[1]-1],[o[0]-1,o[1]-1],[o[0]-2,o[1]],[o[0]-1,o[1]+1],[o[0]+1,o[1]+1]]:[[o[0]+1,o[1]],[o[0]-1,o[1]],[o[0],o[1]+1],[o[0],o[1]-1]];for(let o=0;o<s.length;o++){let h=this._pointKey(s[o]);null==t[h]&&this._freeSpace(s[o][0],s[o][1],n)&&(t[h]=s[o],r||delete e[h],i.push(s[o]))}}}_tunnelToConnected(t,e,i,r,n,s){let o,h;e[0]<t[0]?(o=e,h=t):(o=t,h=e);for(let t=o[0];t<=h[0];t++){this._map[t][o[1]]=n;let e=[t,o[1]],s=this._pointKey(e);i[s]=e,delete r[s]}s&&o[0]<h[0]&&s(o,[h[0],o[1]]);let l=h[0];e[1]<t[1]?(o=e,h=t):(o=t,h=e);for(let t=o[1];t<h[1];t++){this._map[l][t]=n;let e=[l,t],s=this._pointKey(e);i[s]=e,delete r[s]}s&&o[1]<h[1]&&s([h[0],o[1]],[h[0],h[1]])}_tunnelToConnected6(t,e,i,r,n,s){let o,h;e[0]<t[0]?(o=e,h=t):(o=t,h=e);let l=o[0],a=o[1];for(;l!=h[0]||a!=h[1];){let t=2;a<h[1]?(a++,t=1):a>h[1]&&(a--,t=1),l<h[0]?l+=t:l>h[0]?l-=t:h[1]%2?l-=t:l+=t,this._map[l][a]=n;let e=[l,a],s=this._pointKey(e);i[s]=e,delete r[s]}s&&s(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}},Digger:i(10).default,EllerMaze:class extends I.a{create(t){let e,i=this._fillMap(1),r=Math.ceil((this._width-2)/2),s=[],o=[];for(let t=0;t<r;t++)s.push(t),o.push(t);for(s.push(r-1),e=1;e+3<this._height;e+=2)for(let t=0;t<r;t++){let r=2*t+1,h=e;i[r][h]=0,t!=s[t+1]&&n.a.getUniform()>.375&&(z(t,s,o),i[r+1][h]=0),t!=s[t]&&n.a.getUniform()>.375?F(t,s,o):i[r][h+1]=0}for(let t=0;t<r;t++){let r=2*t+1,h=e;i[r][h]=0,t!=s[t+1]&&(t==s[t]||n.a.getUniform()>.375)&&(z(t,s,o),i[r+1][h]=0),F(t,s,o)}for(let e=0;e<this._width;e++)for(let r=0;r<this._height;r++)t(e,r,i[e][r]);return this}},DividedMaze:class extends I.a{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let e=this._width,i=this._height;this._map=[];for(let t=0;t<e;t++){this._map.push([]);for(let r=0;r<i;r++){let n=0==t||0==r||t+1==e||r+1==i;this._map[t].push(n?1:0)}}this._stack=[[1,1,e-2,i-2]],this._process();for(let r=0;r<e;r++)for(let e=0;e<i;e++)t(r,e,this._map[r][e]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],i=[];for(let i=t[0]+1;i<t[2];i++){let r=this._map[i][t[1]-1],n=this._map[i][t[3]+1];!r||!n||i%2||e.push(i)}for(let e=t[1]+1;e<t[3];e++){let r=this._map[t[0]-1][e],n=this._map[t[2]+1][e];!r||!n||e%2||i.push(e)}if(!e.length||!i.length)return;let r=n.a.getItem(e),s=n.a.getItem(i);this._map[r][s]=1;let o=[],h=[];o.push(h);for(let e=t[0];e<r;e++)this._map[e][s]=1,h.push([e,s]);h=[],o.push(h);for(let e=r+1;e<=t[2];e++)this._map[e][s]=1,h.push([e,s]);h=[],o.push(h);for(let e=t[1];e<s;e++)this._map[r][e]=1,h.push([r,e]);h=[],o.push(h);for(let e=s+1;e<=t[3];e++)this._map[r][e]=1,h.push([r,e]);let l=n.a.getItem(o);for(let t=0;t<o.length;t++){let e=o[t];if(e==l)continue;let i=n.a.getItem(e);this._map[i[0]][i[1]]=0}this._stack.push([t[0],t[1],r-1,s-1]),this._stack.push([r+1,t[1],t[2],s-1]),this._stack.push([t[0],s+1,r-1,t[3]]),this._stack.push([r+1,s+1,t[2],t[3]])}},IceyMaze:class extends I.a{constructor(t,e,i=0){super(t,e),this._regularity=i,this._map=[]}create(t){let e=this._width,i=this._height,r=this._fillMap(1);e-=e%2?1:2,i-=i%2?1:2;let s=0,o=0,h=0,l=0,a=0,u=!1,c=[[0,0],[0,0],[0,0],[0,0]];do{if(s=1+2*Math.floor(n.a.getUniform()*(e-1)/2),o=1+2*Math.floor(n.a.getUniform()*(i-1)/2),a||(r[s][o]=0),!r[s][o]){this._randomize(c);do{0==Math.floor(n.a.getUniform()*(this._regularity+1))&&this._randomize(c),u=!0;for(let t=0;t<4;t++)if(h=s+2*c[t][0],l=o+2*c[t][1],this._isFree(r,h,l,e,i)){r[h][l]=0,r[s+c[t][0]][o+c[t][1]]=0,s=h,o=l,u=!1,a++;break}}while(!u)}}while(a+1<e*i/4);for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,r[e][i]);return this._map=[],this}_randomize(t){for(let e=0;e<4;e++)t[e][0]=0,t[e][1]=0;switch(Math.floor(4*n.a.getUniform())){case 0:t[0][0]=-1,t[1][0]=1,t[2][1]=-1,t[3][1]=1;break;case 1:t[3][0]=-1,t[2][0]=1,t[1][1]=-1,t[0][1]=1;break;case 2:t[2][0]=-1,t[3][0]=1,t[0][1]=-1,t[1][1]=1;break;case 3:t[1][0]=-1,t[0][0]=1,t[3][1]=-1,t[2][1]=1}}_isFree(t,e,i,r,n){return!(e<1||i<1||e>=r||i>=n)&&t[e][i]}},Rogue:class extends I.a{constructor(t,e,i){super(t,e),this.map=[],this.rooms=[],this.connectedCells=[],(i=Object.assign({cellWidth:3,cellHeight:3},i)).hasOwnProperty("roomWidth")||(i.roomWidth=this._calculateRoomSize(this._width,i.cellWidth)),i.hasOwnProperty("roomHeight")||(i.roomHeight=this._calculateRoomSize(this._height,i.cellHeight)),this._options=i}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)t(e,i,this.map[e][i]);return this}_calculateRoomSize(t,e){let i=Math.floor(t/e*.8),r=Math.floor(t/e*.25);return r<2&&(r=2),i<2&&(i=2),[r,i]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let e=0;e<this._options.cellHeight;e++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:e})}}_connectRooms(){let t,e,i,r,s,o,h=n.a.getUniformInt(0,this._options.cellWidth-1),l=n.a.getUniformInt(0,this._options.cellHeight-1),a=!1;do{o=[0,2,4,6],o=n.a.shuffle(o);do{if(a=!1,t=o.pop(),e=h+M.c[8][t][0],i=l+M.c[8][t][1],!(e<0||e>=this._options.cellWidth||i<0||i>=this._options.cellHeight)){if((r=this.rooms[h][l]).connections.length>0&&r.connections[0][0]==e&&r.connections[0][1]==i)break;0==(s=this.rooms[e][i]).connections.length&&(s.connections.push([h,l]),this.connectedCells.push([e,i]),h=e,l=i,a=!0)}}while(o.length>0&&0==a)}while(o.length>0)}_connectUnconnectedRooms(){let t,e,i,r=this._options.cellWidth,s=this._options.cellHeight;this.connectedCells=n.a.shuffle(this.connectedCells);for(let o=0;o<this._options.cellWidth;o++)for(let h=0;h<this._options.cellHeight;h++)if(0==(t=this.rooms[o][h]).connections.length){let l=[0,2,4,6];l=n.a.shuffle(l),i=!1;do{let t=l.pop(),n=o+M.c[8][t][0],a=h+M.c[8][t][1];if(!(n<0||n>=r||a<0||a>=s)){if(i=!0,0==(e=this.rooms[n][a]).connections.length)break;for(let t=0;t<e.connections.length;t++)if(e.connections[t][0]==o&&e.connections[t][1]==h){i=!1;break}if(i)break}}while(l.length);i?t.connections.push([e.cellx,e.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,i,r,s,o=this._width,h=this._height,l=this._options.cellWidth,a=this._options.cellHeight,u=Math.floor(this._width/l),c=Math.floor(this._height/a),_=this._options.roomWidth,f=this._options.roomHeight;for(let p=0;p<l;p++)for(let l=0;l<a;l++){if(0==(i=u*p)&&(i=1),0==(r=c*l)&&(r=1),t=n.a.getUniformInt(_[0],_[1]),e=n.a.getUniformInt(f[0],f[1]),l>0)for(s=this.rooms[p][l-1];r-(s.y+s.height)<3;)r++;if(p>0)for(s=this.rooms[p-1][l];i-(s.x+s.width)<3;)i++;let a=Math.round(n.a.getUniformInt(0,u-t)/2),d=Math.round(n.a.getUniformInt(0,c-e)/2);for(;i+a+t>=o;)a?a--:t--;for(;r+d+e>=h;)d?d--:e--;i+=a,r+=d,this.rooms[p][l].x=i,this.rooms[p][l].y=r,this.rooms[p][l].width=t,this.rooms[p][l].height=e;for(let n=i;n<i+t;n++)for(let t=r;t<r+e;t++)this.map[n][t]=0}}_getWallPosition(t,e){let i,r,s;return 1==e||3==e?(i=n.a.getUniformInt(t.x+1,t.x+t.width-2),s=1==e?1+(r=t.y-2):(r=t.y+t.height+1)-1,this.map[i][s]=0):(r=n.a.getUniformInt(t.y+1,t.y+t.height-2),s=2==e?(i=t.x+t.width+1)-1:1+(i=t.x-2),this.map[s][r]=0),[i,r]}_drawCorridor(t,e){let i,r,s,o,h=e[0]-t[0],l=e[1]-t[1],a=t[0],u=t[1],c=[],_=Math.abs(h),f=Math.abs(l),p=n.a.getUniform(),d=p,g=1-p;for(r=h>0?2:6,s=l>0?4:0,_<f?(i=Math.ceil(f*d),c.push([s,i]),c.push([r,_]),i=Math.floor(f*g),c.push([s,i])):(i=Math.ceil(_*d),c.push([r,i]),c.push([s,f]),i=Math.floor(_*g),c.push([r,i])),this.map[a][u]=0;c.length>0;)for(o=c.pop();o[1]>0;)a+=M.c[8][o[0]][0],u+=M.c[8][o[0]][1],this.map[a][u]=0,o[1]=o[1]-1}_createCorridors(){let t,e,i,r,n,s=this._options.cellWidth,o=this._options.cellHeight;for(let h=0;h<s;h++)for(let s=0;s<o;s++){t=this.rooms[h][s];for(let s=0;s<t.connections.length;s++)e=t.connections[s],(i=this.rooms[e[0]][e[1]]).cellx>t.cellx?(r=2,n=4):i.cellx<t.cellx?(r=4,n=2):i.celly>t.celly?(r=3,n=1):(r=1,n=3),this._drawCorridor(this._getWallPosition(t,r),this._getWallPosition(i,n))}}}};class j{}const B=.5*(Math.sqrt(3)-1),H=(3-Math.sqrt(3))/6;var Y={Simplex:class extends j{constructor(t=256){super(),this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];let e=[];for(let i=0;i<t;i++)e.push(i);e=n.a.shuffle(e),this._perms=[],this._indexes=[];for(let i=0;i<2*t;i++)this._perms.push(e[i%t]),this._indexes.push(this._perms[i]%this._gradients.length)}get(t,e){let i,r,n,s=this._perms,o=this._indexes,l=s.length/2,a=0,u=0,c=0,_=(t+e)*B,f=Math.floor(t+_),p=Math.floor(e+_),d=(f+p)*H,g=t-(f-d),m=e-(p-d);g>m?(r=1,n=0):(r=0,n=1);let y=g-r+H,v=m-n+H,b=g-1+2*H,w=m-1+2*H,x=Object(h.mod)(f,l),E=Object(h.mod)(p,l),S=.5-g*g-m*m;if(S>=0){S*=S,i=o[x+s[E]];let t=this._gradients[i];a=S*S*(t[0]*g+t[1]*m)}let C=.5-y*y-v*v;if(C>=0){C*=C,i=o[x+r+s[E+n]];let t=this._gradients[i];u=C*C*(t[0]*y+t[1]*v)}let T=.5-b*b-w*w;if(T>=0){T*=T,i=o[x+1+s[E+1]];let t=this._gradients[i];c=T*T*(t[0]*b+t[1]*w)}return 70*(a+u+c)}}};class G{constructor(t,e,i,r={}){this._toX=t,this._toY=e,this._passableCallback=i,this._options=Object.assign({topology:8},r),this._dirs=M.c[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(t,e){let i=[];for(let r=0;r<this._dirs.length;r++){let n=this._dirs[r],s=t+n[0],o=e+n[1];this._passableCallback(s,o)&&i.push([s,o])}return i}}var q={Dijkstra:class extends G{constructor(t,e,i,r){super(t,e,i,r),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,i){let r=t+","+e;if(r in this._computed||this._compute(t,e),!(r in this._computed))return;let n=this._computed[r];for(;n;)i(n.x,n.y),n=n.prev}_compute(t,e){for(;this._todo.length;){let i=this._todo.shift();if(i.x==t&&i.y==e)return;let r=this._getNeighbors(i.x,i.y);for(let t=0;t<r.length;t++){let e=r[t],n=e[0],s=e[1];n+","+s in this._computed||this._add(n,s,i)}}}_add(t,e,i){let r={x:t,y:e,prev:i};this._computed[t+","+e]=r,this._todo.push(r)}},AStar:class extends G{constructor(t,e,i,r={}){super(t,e,i,r),this._todo=[],this._done={}}compute(t,e,i){for(this._todo=[],this._done={},this._fromX=t,this._fromY=e,this._add(this._toX,this._toY,null);this._todo.length;){let i=this._todo.shift(),r=i.x+","+i.y;if(r in this._done)continue;if(this._done[r]=i,i.x==t&&i.y==e)break;let n=this._getNeighbors(i.x,i.y);for(let t=0;t<n.length;t++){let e=n[t],r=e[0],s=e[1];r+","+s in this._done||this._add(r,s,i)}}let r=this._done[t+","+e];if(r)for(;r;)i(r.x,r.y),r=r.prev}_add(t,e,i){let r=this._distance(t,e),n={x:t,y:e,prev:i,g:i?i.g+1:0,h:r},s=n.g+n.h;for(let t=0;t<this._todo.length;t++){let e=this._todo[t],i=e.g+e.h;if(s<i||s==i&&r<e.h)return void this._todo.splice(t,0,n)}this._todo.push(n)}_distance(t,e){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(e-this._fromY);case 6:let i=Math.abs(t-this._fromX),r=Math.abs(e-this._fromY);return r+Math.max(0,(i-r)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(e-this._fromY))}}}};class ${constructor(t){this._scheduler=t,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let t=this._scheduler.next();if(!t)return this.lock();let e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this}}class Q{constructor(t,e={}){this._reflectivityCallback=t,this._options={},e=Object.assign({passes:1,emissionThreshold:100,range:10},e),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)}setOptions(t){return Object.assign(this._options,t),t&&t.range&&this.reset(),this}setFOV(t){return this._fov=t,this._fovCache={},this}setLight(t,e,i){let r=t+","+e;return i?this._lights[r]="string"==typeof i?c.fromString(i):i:delete this._lights[r],this}clearLights(){this._lights={}}reset(){return this._reflectivityCache={},this._fovCache={},this}compute(t){let e={},i={},r={};for(let t in this._lights){let e=this._lights[t];i[t]=[0,0,0],c.add_(i[t],e)}for(let t=0;t<this._options.passes;t++)this._emitLight(i,r,e),t+1!=this._options.passes&&(i=this._computeEmitters(r,e));for(let e in r){let i=e.split(",");t(parseInt(i[0]),parseInt(i[1]),r[e])}return this}_emitLight(t,e,i){for(let r in t){let n=r.split(","),s=parseInt(n[0]),o=parseInt(n[1]);this._emitLightFromCell(s,o,t[r],e),i[r]=1}return this}_computeEmitters(t,e){let i={};for(let r in t){if(r in e)continue;let n,s=t[r];if(r in this._reflectivityCache)n=this._reflectivityCache[r];else{let t=r.split(","),e=parseInt(t[0]),i=parseInt(t[1]);n=this._reflectivityCallback(e,i),this._reflectivityCache[r]=n}if(0==n)continue;let o=[0,0,0],h=0;for(let t=0;t<3;t++){let e=Math.round(s[t]*n);o[t]=e,h+=e}h>this._options.emissionThreshold&&(i[r]=o)}return i}_emitLightFromCell(t,e,i,r){let n,s=t+","+e;n=s in this._fovCache?this._fovCache[s]:this._updateFOV(t,e);for(let t in n){let e,s=n[t];t in r?e=r[t]:(e=[0,0,0],r[t]=e);for(let t=0;t<3;t++)e[t]+=Math.round(i[t]*s)}return this}_updateFOV(t,e){let i=t+","+e,r={};this._fovCache[i]=r;let n=this._options.range;return this._fov.compute(t,e,n,function(t,e,i,s){let o=s*(1-i/n);0!=o&&(r[t+","+e]=o)}.bind(this)),r}}i.d(e,"Util",function(){return J}),i.d(e,"Color",function(){return Z}),i.d(e,"Text",function(){return tt}),i.d(e,"RNG",function(){return n.a}),i.d(e,"Display",function(){return K}),i.d(e,"StringGenerator",function(){return O}),i.d(e,"EventQueue",function(){return A}),i.d(e,"Scheduler",function(){return R}),i.d(e,"FOV",function(){return U}),i.d(e,"Map",function(){return X}),i.d(e,"Noise",function(){return Y}),i.d(e,"Path",function(){return q}),i.d(e,"Engine",function(){return $}),i.d(e,"Lighting",function(){return Q}),i.d(e,"DEFAULT_WIDTH",function(){return M.b}),i.d(e,"DEFAULT_HEIGHT",function(){return M.a}),i.d(e,"DIRS",function(){return M.c}),i.d(e,"KEYS",function(){return M.d});const J=h,Z=c,tt=r}]);